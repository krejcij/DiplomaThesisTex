\chapter{Wireless M-Bus zařízení}
\label{ChapterZarizeni}

Pro účely testování komunikace bylo využito několik typů dostupných zařízení:
\begin{itemize}
	\item pokojové čidlo teploty a vlhkosti Weptech OMST-868A~\cite{CidloWeptech},
	\item modul pro vodoměry Bonega~\cite{CidloBonega},
	\item ultrazvukový měřič tepla a chladu Kamstrup Multical 402~\cite{CidloKamstrup},
	\item třífázový elektroměr ZPA ZE.310~\cite{CidloZpa}.
\end{itemize}

Všechna tyto zařízení poskytují formát dat dle platné specifikace OMS~(Open Metering Standard)~3.0.1~\cite{NormaOMS}, která vychází z normy EN 13757-4~\cite{Norma4} pro bezdrátový protokol WM-Bus.

Pro základní komunikaci bylo zvoleno čidlo teploty a vlhkosti Weptech OMST-868A, z důvodu volné dostupnosti kompletní dokumentace a možností nastavení parametrů vysílání včetně volitelného šifrování přenášených dat. Jako jediné z výše jmenovaných čidel nevyžaduje ke své činnosti žádná doplňující média či přístroje.
	
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	
	
	\section{Weptech OMST-868A}
	
	Weptech OMST-868A je teplotní a vlhkostní čidlo podporující protokol Wireless M-Bus. Je určeno pro vnitřní využití a proto je dodáváno v pouzdře určeném pro montáž na zeď.
	
	

\begin{figure*}[!ht]
\vspace{-5pt}
    \centering
			\subfigure[Zapouzdřené čidlo]{\includegraphics[width=0.32\textwidth]{obrazky/zarizeni_weptech1}\label{zarizeni_weptech1}}
			\hspace*{5mm}
			\subfigure[Deska čidla]{\includegraphics[width=0.32\textwidth]{obrazky/zarizeni_weptech2}\label{zarizeni_weptech2}}
		\caption{Čidlo Weptech OMST-868A~\cite{CidloWeptech}}
		\vspace{-25pt}
\end{figure*}

\subsubsection{Parametry čidla}
\begin{itemize}
	\item Rozsah měření vlhkosti: 20 až 80\,\%.
	\item Přesnost měření vlhkosti: ± 2\,\%.
	\item Rozsah měření teploty: -10\,°C až 55\,°C.
	\item Přesnost měření teploty: ± 0,3\,°C.
	\item Teplotní hystereze: 0,1\,°C.
	\item Mód přenosu: S nebo T.
	\item Interval přenosu: konfigurovatelný v rozsahu 5~sekund až 24~hodin.
	\item Šifrování přenosu: volitelný AES-128~mód~5.
	\item Napájení: 2~x~AA baterie.
	\item Výdrž baterie: dle módu a intervalu přenosu až 10~let.
\end{itemize}


\subsubsection{Formát telegramu}

Telegram má specifickou základní strukturu popsanou v Tab.~\ref{TabulkaTelegramWeptech}~\cite{CidloWeptech}:

\begin{table}[!ht]
\centering
\caption{Telegram ze zařízení Weptech 868A~\cite{CidloWeptech}}
\label{TabulkaTelegramWeptech}
%\resizebox{\textwidth}{!}{%
\resizebox{.42\paperheight}{!}{%
\begin{tabular}{|c|l|c|}
\hline
\textbf{Pole}      & \textbf{Popis pole}            & \textbf{Hodnota} \\ \hline \hline
L-Field            & Délka telegramu                                & 1Eh              \\ \hline
C-Field            & Typ telegramu                                  & 44h              \\ \hline
M-Field            & Výrobce zařízení                               & B0h              \\ \hline
M-Field            & Výrobce zařízení                               & 5Ch              \\ \hline
A-Field            & Sériové číslo                                  & 11h              \\ \hline
A-Field            & Sériové číslo                                  & 47h              \\ \hline
A-Field            & Sériové číslo                                  & 15h              \\ \hline
A-Field            & Sériové číslo                                  & 08h              \\ \hline
A-Field            & Verze zařízení                                 & 01h              \\ \hline
A-Field            & Typ zařízení                                   & 1Bh              \\ \hline
Ci-pole            & Odpověd od zařízení                            & 7Ah              \\ \hline
Access Number      & Číslo přístupu                                 & 41h              \\ \hline
Status             & Status zařízení                                & 00h              \\ \hline
Configuration word & Konfigurační řetězec AES                       & 00h              \\ \hline
Configuration word & Konfigurační řetězec AES                       & 00h              \\ \hline
AES verification   & Ověření AES                                  & 2Fh              \\ \hline
AES verification   & Ověření AES                                  & 2Fh              \\ \hline
DR1                & DIF: 4 cifry BCD                               & 0Ah              \\ \hline
DR1                & VIF: teplota ve stupních Celsia na mínus první & 66h              \\ \hline
DR1                & Hodnota teploty                                & 99h              \\ \hline
DR1                & Hodnota teploty                                & 01h              \\ \hline
DR2                & DIF: 4 cifry BCD                               & 0Ah              \\ \hline
DR2                & VIF: První rozšiřovací tabulka                 & FBh              \\ \hline
DR2                & VIFE: vlhkost procentech na mínus první        & 1Ah              \\ \hline
DR2                & Hodnota relativní vlhkosti                               & 93h              \\ \hline
DR2                & Hodnota relativní vlhkosti                               & 02h              \\ \hline
DR3                & DIF: 16bit integer/binary                      & 02h              \\ \hline
DR3                & VIF: Druhá rozšiřovací tabulka                 & FDh              \\ \hline
DR3                & VIFE0: Chybové stavy                           & 97h              \\ \hline
DR3                & VIFE1: Norma 																	& 1Dh              \\ \hline
DR3                & Příznak sabotáže                               & 00h              \\ \hline
DR3                & Příznak vybité baterie                         & 00h              \\ \hline
Fill               & Výplňové byty (13x)                                 & 2Fh              \\ \hline \hline
\end{tabular}}
\end{table}

\newpage{}

Některé z položek je potřeba blíže vysvětlit:

\begin{itemize}
	%\item Access number - Toto číslo se s každým požadavkem zvýší o hodnotu 1.
	%\item Status - V případě úspěšného přenosu je zde uložena nula, v opačném případě je zde uložena logická jednička a nastal tedy chybový stav 'sabotáž' nebo 'vybitá baterie'.
	%\item Configuration word - V případě zapnutého šifrovaní, první bajt obsahuje počet zašifrovaných bloků, obsah telegarmu a inkrement. Druhý bajt obsahuje záznam o obousměrnosti, dostupnosti, synchronizaci a šifrování. Pokud je šifrování zapnuto, je nastaven mód 5, v opačném případě jsou oba bajty nulové.
	\item Příznak sabotáže čidla - Pokud čidlo pomocí integrovaného spínače detekuje uvolnění krytu z montážní desky, pošle výstrahu přes rádio do přijímače, tedy změní pro nejbližší a všechny následující vysílání tamper bit v telegramu. Tento bit slouží jako ochrana před neoprávněnou manipulací s čidlem a může být vymazán pouze restartem zařízení. Tedy vyjmutím starých baterií, ponecháním zařízení několik minut bez napájení, aby došlo k vybití všech kondenzátorů a~následným vložením baterií.
\item Příznak vybité baterie - Pokud elektronika v čidlu vyhodnotí úroveň nabití baterie jako nedostatečnou, nastaví bit vybití baterie v telegramu. Tento bit ošetřuje stavy, kdy nedostatečně nabité baterie způsobí příliš velký rozptyl naměřených hodnot, v krajních případech i mimo měřící rozsah čidla. Tento bit může být vymazán také pouze restartem zařízení, jako v předchozím případě.
\item Položky hodnota teploty, hodnota vlhkosti, výrobce zařízení a sériové číslo jsou uloženy v kódování big-endian, tedy na paměťové místo s nejnižší adresou se~uloží nejvíce významný bajt a za něj se ukládají ostatní bajty až~po~nejméně významný bajt na konci. Uživatelská hodnota se tedy vyčítá pozpátku po~jednotlivých bajtech.
\item Telegram je ukončen 13 výplňovými bajty, které nenesou žádnou informaci.
\end{itemize}


\subsubsection{Nastavení čidla}
Čidlo má k dispozici několik nastavení. Některé z nich lze nastavit pomocí čtyř přepínačů DIP (Dual Inline Package) na desce plošných spojů.
První přepínač zapíná AES-128 šifrování, druhý přepínač přepíná mezí módem vysílání S (poloha ON) a módem T (poloha OFF), třetí a čtvrtý přpínač určují interval zasílání telegramu, jejich nastavení shrnuje Tab.~\ref{TablukaDIP}.


\begin{table}[!ht]
\centering
\caption{Konfigurace intervalu zasílání pomocí DIP přepínače~\cite{CidloWeptech}}
\label{TablukaDIP}
\begin{tabular}{|c|c|c|}
\hline
\textbf{Interval zasílání} & přepínač DIP 3 & přepínač DIP 4 \\ \hline \hline
1 minuta & ON & ON \\ \hline
5 minut & OFF & ON \\ \hline
10 minut & ON & OFF \\ \hline
15 minut & OFF & OFF \\ \hline \hline
\end{tabular}
\end{table}

Jiné hodnoty mohou být nastaveny pouze během výroby daného zařízení, viz Tab.~\ref{TablukaSETUP}.

\begin{table}[!ht]
\centering
\caption{Přehled nastavení čidla \cite{CidloWeptech}}
\label{TablukaSETUP}
\begin{tabular}{|c|l|c|}
\hline
\textbf{Parametr} & \multicolumn{1}{c|}{\textbf{Popis}} & \textbf{\begin{tabular}[c]{@{}c@{}}DIP přepínač\end{tabular}} \\ \hline \hline
AES enable & \begin{tabular}[c]{@{}l@{}}Možnost zapnutí či vypnutí šifrování \\ přenášených dat.\end{tabular} & 1 \\ \hline
%AES key & \begin{tabular}[c]{@{}l@{}}AES klíč je zapsán při výrobě zařízení, \\ nelze ho uživatelsky měnit. Hodnota \\ klíče je 00 01 02 03 04 05 06 07 08 \\ 09 0A 0B 0C 0D 0E 0F.\end{tabular} &  \\ \hline
wM-Bus mode & \begin{tabular}[c]{@{}l@{}}Implementovány jsou módy S1-m \\ a T1. Ostatní módy lze nastavit\\ pouze při tovární výrobě.\end{tabular} & 2 \\ \hline
Transmission interval & \begin{tabular}[c]{@{}l@{}}Interval je výrobcem konfigurovatelný \\ v intervalu 2 až 65534 sekund. \\ Předvolby (60s, 300s, 600s, 900s) \\ jsou uživatelsky nastavitelné pomocí \\ DIP přepínače.\end{tabular} & 3 a 4 \\ \hline \hline
%Address & \begin{tabular}[c]{@{}l@{}}Adresa zařízení je výrobcem udaná \\ hodnota, obsahující identifikaci \\ výrobce „WEP“, sériového číslo čidla, \\ verzi zařízení (1) a typ \\ zařízení (1Bh - pokojové čidlo)\end{tabular} &  \\ \hline
%Tamper & \begin{tabular}[c]{@{}l@{}}Odezva od čidla pro otevření \\ boxu může být povolena či \\ zakázána, samotné zařízení \\ existuje i ve verzích bez \\ tohoto čidla.\end{tabular} & \multicolumn{1}{l|}{} \\ \hline
%Config & \begin{tabular}[c]{@{}l@{}}Změna nastavení pomocí DIP \\ přepínače může být povolena \\ či zakázána, samotné zařízení \\ existuje i ve verzích bez\\  tohoto přepínače.\end{tabular} & \multicolumn{1}{l|}{} \\ \hline
\end{tabular}
\end{table}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	
	\section{Bonega}

Modul Bonega je bezdrátové čidlo podporující protokol Wireless M-Bus. Jedná se~o~samostatné zařízení, které je určené pro montáž na vodoměry Bonega. Na~řadu vodoměrů podporujících tento modul je možná i dodatečná montáž. Elektronická část modulu slouží současně pro vyčítání dvou vodoměrů, na teplou i studenou vodu.
	
	\begin{figure*}[!ht]
	\vspace{-15pt}
    \centering
			\subfigure[Vodoměr studené vody]{\includegraphics[width=0.3\textwidth]{obrazky/zarizeni_bonega1}\label{zarizeni_bonega1}}
			\hspace*{5mm}
			\subfigure[Bezdrátový modul]{\includegraphics[width=0.3\textwidth]{obrazky/zarizeni_bonega2}\label{zarizeni_bonega2}}
			\hspace*{5mm}
			\subfigure[Vodoměr teplé vody]{\includegraphics[width=0.3\textwidth]{obrazky/zarizeni_bonega3}\label{zarizeni_bonega3}}
		\caption{Sada Bonega~\cite{CidloBonega}}
\end{figure*}


\vspace{-30pt}
\subsubsection{Parametry modulu}
\begin{itemize}
	\item Rozsah měření: 0 až 65536 m\textsuperscript{2}.
	\item Přesnost měření: ± 1\,litr.
	\item Maximální detekovatelný průtok: 6\,m\textsuperscript{3}/hod.
	\item Mód přenosu: T1.
	\item Stupeň krytí: IP64.
	\item Interval přenosu: 20-24\,sekund v odpočtovém období (od 1.11. do 15.1.)
	\item Interval přenosu: 4\,minuty mimo odpočtové období.
	\item Šifrování přenosu: AES-128~mód~5.
	\item Napájení: integrovaná baterie.
	\item Výdrž baterie: až 12~let.
\end{itemize}


\subsubsection{Formát telegramu}
Zařízení vysílá postupně dva telegramy, s rozlišením šestým bajtem adresy zařízení, jeden pro vodoměr teplé vody a druhý pro vodoměr studené vody.
Telegram má specifickou základní strukturu popsanou v Tab. \ref{TabulkaTelegram2}~\cite{CidloBonega}:

\begin{table}[!ht]
\centering
\caption{Telegram z modulu Bonega~\cite{CidloBonega}}
%\resizebox{\textwidth}{!}{%
\resizebox{.43\paperheight}{!}{%
\label{TabulkaTelegram2}
\begin{tabular}{|c|l|c|}
\hline
\textbf{Pole}      & \textbf{Popis pole}            & \textbf{Hodnota} \\ \hline \hline
L-Field            & Délka telegramu                                & 1Eh              \\ \hline
C-Field            & Typ telegramu                                  & 44h              \\ \hline
M-Field            & Výrobce zařízení                               & B0h              \\ \hline
M-Field            & Výrobce zařízení                               & 5Ch              \\ \hline
A-Field            & Sériové číslo                                  & 11h              \\ \hline
A-Field            & Sériové číslo                                  & 47h              \\ \hline
A-Field            & Sériové číslo                                  & 15h              \\ \hline
A-Field            & Sériové číslo                                  & 08h              \\ \hline
A-Field            & Verze zařízení                                 & 01h              \\ \hline
A-Field            & Typ zařízení                                   & 1Bh              \\ \hline
Ci-pole            & Odpověd od zařízení                            & 7Ah              \\ \hline
Access Number      & Číslo přístupu                                 & 41h              \\ \hline
Status             & Status zařízení                                & 00h              \\ \hline
Signature field 	 & Konfigurační řetězec AES                       & 00h              \\ \hline
Signature field    & Konfigurační řetězec AES                       & 00h              \\ \hline
Data						   & Ověření AES                                    & 2Fh              \\ \hline
Data						   & Ověření AES                                    & 2Fh              \\ \hline
Data               & DIF: 2 cifry BCD (určení formátu průtoku)      & 04h              \\ \hline
Data               & VIF: Objemový průtok v m krychlových na mínus první & 13h         \\ \hline
Data               & Hodnota průtoku                               & 99h               \\ \hline
Data               & Hodnota průtoku                               & 99h               \\ \hline
Data               & Hodnota průtoku                               & 99h               \\ \hline
Data               & Hodnota průtoku                               & 99h               \\ \hline
Data               & DIF: 2 cifry BCD (určení formátu času)         & 6Dh              \\ \hline
Data               & DIF: 2 cifry BCD                               & 6Dh              \\ \hline
Data               & Čas odeslání měření                           & 99h               \\ \hline
Data               & Čas odeslání měření                           & 99h               \\ \hline
Data               & Čas odeslání měření                           & 99h               \\ \hline
Data               & Čas odeslání měření                           & 99h               \\ \hline	
Data						   & Ověření AES                                    & 2Fh              \\ \hline
Data						   & Ověření AES                                    & 2Fh              \\ \hline \hline

\end{tabular}}
\end{table}

\newpage{}

Modul Bonega pracuje pouze v režimu šifrování přenášenných dat pomocí AES128 mód 5. Při přenosu je tedy celá sekce data šifrována, telegram popsaný v Tab. \ref{TabulkaTelegram2} je popisován po dešifrování.

Některé z položek je potřeba blíže vysvětlit:

\begin{itemize}
	\item Hodnota průtoku - aktuální hodnota průtoku je zde vyjádřena čtyři hexadecimálními bajty v LSB pořadí.
	\item Čas odeslání měření - Datum a čas provedení posledního měření. Nejedná se~o~čas posledního odečtu či odeslání posledního telegramu.
\end{itemize}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	
	\section{Kamstrup}
	
	Kamstrup Multical 402 je kompatkní ultrazvukový měřič tepla a chladu, tedy kombinace kalorimetru a ultrazvukového průtokoměru. Je určen k měření tepla, chladu a kombinovanému měření tepla a chladu ve všech systémech na bázi vody s rozmetím teplot 2\,$^{\circ}$C az 130\,$^{\circ}$C. Skládá se z kalkulátoru, průtokoměru a dvou teplotních snímačů. 
	
 \begin{figure}[!ht]
\vspace{-20pt}
  \begin{center}
    \includegraphics[scale=0.7]{obrazky/zarizeni_kamstrup}
  \end{center}
	\vspace{-30pt}
  \caption{Kamstrup Multical 402~\cite{CidloKamstrup}}
	\vspace{-20pt}
\end{figure}
	
		
\subsubsection{Parametry zařízení}
\begin{itemize}
	\item Rozsah měření průtoku: 0,6 až 15 m\textsuperscript{3}/hod.
	\item Rozsah měření teploty vody: 2 až 180 $^{\circ}$C.
	\item Rozsah teploty vody kalkulátorem: 2 až 130 $^{\circ}$C.
	\item Mód přenosu: T1 nebo C1.
	\item Interval přenosu: 15\,minut 
	\item Šifrování přenosu: AES-128~mód~5.
	\item Napájení: integrovaná baterie.
	\item Výdrž baterie: až 16~let.
\end{itemize}

\vspace{+10pt}	
	
Měřič pracuje v režimech T1 a C1  povinným šifrováním přenášených dat pomocí AES128 v módu CBC. Při každém přenosu poskytuje 9 aktuálních hodnot a~2~souhrnné hodnoty za poslední rok:

\begin{itemize}
	\item Tepelná energie (přívodní nebo vratné potrubí).
	\item Enegie chladu (přívodní nebo vratné potrubí).
	\item Energie vratného potrubí.
	\item Energie přívodního potrubí.
	\item Měření průtoku.
	\item Měření výkonu.
	\item Minimální a maximální průtok a výkon.
	\item Měření teploty.
\end{itemize}

\vspace{+10pt}	

Souhrné hodnoty jsou ve výchozím stavu zasílány jako roční přehled, ale lze je~překonfigurováním WM-Bus modulu v měřiči změnit na měsíční interval.

\subsubsection{Formát telegramu}
Telegram je ve výchozím stavu vysílán každých 15 minut pro aktuální hodnoty a~má~specifickou základní strukturu popsanou v Tab. \ref{TabulkaTelegramKamstrup}~\cite{CidloKamstrup}, kde sekce DR1 až~DR12 postupně odpovídají měřeným hodnotám:

	\begin{enumerate}
		\item Tepelná energie (přívodní nebo vratné potrubí).
		\item Enegie chladu (přívodní nebo vratné potrubí).
		\item Energie vratného potrubí.
		\item Energie přívodního potrubí.
		\item Průtok.
		\item Výkon.
		\item Teplota.
		\item Minimální průtok a výkon.
		\item Minimální výkon.
		\item Maximální průtok.
		\item Maximální výkon.
		\item Čas provedení odečtu.
	\end{enumerate}

\begin{table}[!ht]
\centering
\caption{Telegram ze zařízení Kamstrup Multical 402~\cite{CidloKamstrup}}
\label{TabulkaTelegramKamstrup}
%\resizebox{\textwidth}{!}{%
\begin{tabular}{|c|l|c|}
\hline
\textbf{Pole}      & \textbf{Popis pole}            & \textbf{Hodnota} \\ \hline \hline
A-Field            & Sériové číslo         & 11h \\ \hline
A-Field            & Sériové číslo         & 37h \\ \hline
A-Field            & Sériové číslo         & 35h \\ \hline
A-Field            & Verze zařízení        & 11h \\ \hline
A-Field            & Typ zařízení          & 04h \\ \hline
Ci-pole            & Odpověd od zařízení   & 72h \\ \hline
AccNo              & Číslo přístupu        & CAh \\ \hline
Status             & Status zařízení       & 10h \\ \hline
Configuration word & Nastavení šifrovaní & 50h \\ \hline
Configuration word & Nastavení šifrovaní & 05h \\ \hline
AES encryption     & Kontrola dešifrovaní & 2Fh \\ \hline
AES encryption     & Kontrola dešifrovaní & 2Fh \\ \hline
DR1                & DIF: 4 binárni bajty   & 04h \\ \hline
DR1                & VIF: energie v kWh    & 0Fh \\ \hline
DR1                & hodnota energie       & 99h \\ \hline
DR1                & hodnota energie       & 99h \\ \hline
DR1                & hodnota energie       & 99h \\ \hline
DR1                & hodnota energie       & 99h \\ \hline
…                  & …                     & ..  \\ \hline
DR12               & DIF: 4 binární bajty   & 04h \\ \hline
DR12               & VIF: průtok v m\textsuperscript{3}      & 14h \\ \hline
DR12               & hodnota průtoku       & 99h \\ \hline
DR12               & hodnota průtoku       & 99h \\ \hline
DR12               & hodnota průtoku       & 99h \\ \hline
DR12               & hodnota průtoku       & 99h \\ \hline
Fill               & Výplňové bajty         & 2Fh \\ \hline
Fill               & Výplňové bajty         & 2Fh \\ \hline
Fill               & Výplňové bajty         & 2Fh \\ \hline
Fill               & Výplňové bajty         & 2Fh \\ \hline
Fill               & Výplňové bajty         & 2Fh \\ \hline
Fill               & Výplňové bajty         & 2Fh \\ \hline
Fill               & Výplňové bajty         & 2Fh \\ \hline \hline
\end{tabular}%}
\end{table}

\vspace{10pt}

Zařízení bylo pro účely práce pouze zapůjčeno, aby byla ověřena funkčnost příjmu hodnot z daného zařízení. Zařízení bylo celou dobu testování v reálném provozu, proto vyčítané hodnoty nebyly ukládány ani nijak dále zpracovávány.

\newpage
	
	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	
	\section{ZPA}

ZPA ZE310 je třífázový elektronický dvoutarifní elektroměr pro měření činné energie, určený pro přímé i nepřímé připojení. Daný model vysílá v módu T2 s intervalem vysílání jedna minuta, vysílány jsou hodnoty spotřeby v obou tarifech.

	 \begin{figure}[!h]
  \begin{center}
    \includegraphics[scale=0.30]{obrazky/zarizeni_zpa}
  \end{center}
	\vspace{-20pt}
  \caption{ZPA ZE.310~\cite{CidloZpa}}
	\vspace{-30pt}
\end{figure}


\subsubsection{Parametry zařízení}
\begin{itemize}
	\item Počet měřených fází: 3 (daný subtyp).
	\item Počet tarifů: 2 (daný subtyp).
	\item Režim krytí: IP54.
	\item Mód přenosu: T1.
	\item Interval přenosu: 1\,minuta.
\end{itemize}

\subsubsection{Formát telegramu}
Telegram je ve výchozím stavu vysílán každou minutu a poskytuje výrobcem doplněnou základní strukturu popsanou v Tab. \ref{TabulkaTelegramZPA}~\cite{CidloZpa}.

\begin{table}[!ht]
\centering
\caption{Telegram ze zařízení ZPA ZE.302~\cite{CidloZpa}}
\label{TabulkaTelegramZPA}
%\resizebox{\textwidth}{!}{%
\begin{tabular}{|c|l|c|}
\hline
\textbf{Pole}      & \textbf{Popis pole}            & \textbf{Hodnota} \\ \hline \hline
L-Field & Délka telegramu & 2Ah \\ \hline
C-Field & Typ telegramu & 44h \\ \hline
M-Field & Výrobce zařízení & 01h \\ \hline
M-Field & Výrobce zařízení & 6Ah \\ \hline
A-Field & Sériové číslo & 44h \\ \hline
A-Field & Sériové číslo & 93h \\ \hline
A-Field & Sériové číslo & 67h \\ \hline
A-Field & Sériové číslo & 12h \\ \hline
A-Field & Verze zařízení & 01h \\ \hline
A-Field & Typ zařízení & 02h \\ \hline
CRC & Kontrolní součet & 22h \\ \hline
CRC & Kontrolní součet & 80h \\ \hline
Ci-pole & Odpověd od zařízení & 72h \\ \hline
Identification Number & Sériové číslo & 44h \\ \hline
Identification Number & Sériové číslo & 93h \\ \hline
Identification Number & Sériové číslo & 67h \\ \hline
Identification Number & Sériové číslo & 12h \\ \hline
Manifacturer ID & Výrobce zařízení & 01h \\ \hline
Manifacturer ID & Výrobce zařízení & 6Ah \\ \hline
Version & Verze zařízení & 01h \\ \hline
Device type & Typ zařízení & 02h \\ \hline
AccNo & Číslo přístupu & CAh \\ \hline
Status & Status zařízení & 10h \\ \hline
Configuration word & Položky šifrovaní AES & 50h \\ \hline
Configuration word & Položky šifrovaní AES & 05h \\ \hline
DIF & DIF & 86h \\ \hline
DIFE & DIFE & 20h \\ \hline
VIF & VIF & 83h \\ \hline
CRC & Kontrolní součet & C8h \\ \hline
CRC & Kontrolní součet & 97h \\ \hline
VIFE & VIFE & 00h \\ \hline
DATA1 & Hodnota spotřeby tafifu 1 & 76h \\ \hline
DATA1 & Hodnota spotřeby tafifu 1 & 23h \\ \hline
\end{tabular}
\end{table}

\begin{table}[!ht]
\centering
%\resizebox{\textwidth}{!}{%
\begin{tabular}{|c|l|c|}
\hline
\textbf{Pole}      & \textbf{Popis pole}            & \textbf{Hodnota} \\ \hline

DATA1 & Hodnota spotřeby tafifu 1 & 85h \\ \hline
DATA1 & Hodnota spotřeby tafifu 1 & 01h \\ \hline
DATA1 & Hodnota spotřeby tafifu 1 & 00h \\ \hline
DATA1 & Hodnota spotřeby tafifu 1 & 00h \\ \hline
DIF & DIF & 86h \\ \hline
DIFE & DIFE & 20h \\ \hline
VIF & VIF & 83h \\ \hline
VIFE & VIFE & 00h \\ \hline
DATA2 & Hodnota spotřeby tafifu 2 & 97h \\ \hline
DATA2 & Hodnota spotřeby tafifu 2 & 31h \\ \hline
DATA2 & Hodnota spotřeby tafifu 2 & 92h \\ \hline
DATA2 & Hodnota spotřeby tafifu 2 & 00h \\ \hline
DATA2 & Hodnota spotřeby tafifu 2 & 00h \\ \hline
CRC & Kontrolní součet & C8h \\ \hline
CRC & Kontrolní součet & 97h \\ \hline
Data & Kontrolní data & 00h \\ \hline
CRC & Kontrolní součet & C8h \\ \hline
CRC & Kontrolní součet & 97h \\ \hline \hline
\end{tabular}
\end{table}

\newpage

\vspace{+10pt}	

Položky DATA1 a DATA2 obsahují hodnoty obou tarifů uložené v LSB a vyjádřené v KWh.

